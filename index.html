<!DOCTYPE html>

<html lang="en-US">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bugle call</title>
  <script src="../jsgame0.js"></script>
  <script id="calls" type="application/json">
{
  "Adjutant's Call": [
    ["G5", 0.258620689655],
    ["E5", 0.129310344828],
    ["C5", 0.129310344828],
    ["G5", 0.5172413793103449],
    ["G5", 0.258620689655],
    ["E5", 0.129310344828],
    ["C5", 0.129310344828],
    ["G5", 0.5172413793103449],
    ["G5", 0.258620689655],
    ["E5", 0.129310344828],
    ["C5", 0.129310344828],
    ["G4", 0.258620689655],
    ["G5", 0.258620689655],
    ["E5", 0.258620689655],
    ["G5", 0.129310344828],
    ["E5", 0.129310344828],
    ["C5", 0.5172413793103449],
    ["E5", 0.258620689655],
    ["G5", 0.129310344828],
    ["E5", 0.129310344828],
    ["C5", 0.5172413793103449]
  ],
  "Assembly": [
    ["G4", 0.225],
    ["G4", 0.075],
    ["C5", 0.225],
    ["G4", 0.075],
    ["C5", 0.225],
    ["E5", 0.075],
    ["C5", 0.3],
    ["C5", 0.225],
    ["C5", 0.075],
    ["E5", 0.225],
    ["C5", 0.075],
    ["E5", 0.225],
    ["G5", 0.075],
    ["E5", 0.3],
    ["C5", 0.225],
    ["E5", 0.075],
    ["G5", 0.3],
    ["E5", 0.225],
    ["C5", 0.075],
    ["G4", 0.3],
    ["G4", 0.225],
    ["G4", 0.075],
    ["C5", 0.3],
    ["C5", 0.225],
    ["C5", 0.075],
    ["C5", 0.3]
  ],
  "Attention": [
    ["G4", 0.25],
    ["C5", 0.375],
    ["C5", 0.125],
    ["C5", 0.25],
    ["G4", 0.375],
    ["G4", 0.125],
    ["G4", 0.25],
    ["E5", 0.375],
    ["C5", 0.125],
    ["E5", 0.25],
    ["G4", 0.75],
    ["C5", 0.375],
    ["C5", 0.125],
    ["C5", 0.25],
    ["C5", 0.375],
    ["E5", 0.125],
    ["C5", 0.25],
    ["G4", 0.375],
    ["G4", 0.125],
    ["G4", 0.25],
    ["C5", 0.5]
  ],
  "Boots and Saddles": [
    ["G4", 0.375],
    ["C5", 0.375],
    ["E5", 0.375],
    ["G5", 0.375],
    ["E5", 0.375],
    ["C5", 0.375],
    ["G4", 0.375],
    ["C5", 0.375],
    ["C5", 0.1875],
    ["C5", 0.1875],
    ["C5", 0.1875],
    ["C5", 0.375],
    ["C5", 0.375],
    ["G4", 0.375],
    ["C5", 0.375],
    ["C5", 0.5625],
    ["C5", 0.1875],
    ["C5", 0.5625],
    ["C5", 0.1875],
    ["C5", 0.75]
  ],
  "British Alarm": [
    ["C5", 0.138888888888],
    ["E5", 0.833333333325],
    ["G4", 0.277777777775],
    ["E5", 0.5555555555555556]
  ],
  "Call to Quarters": [
    ["C5", 0.6],
    ["E5", 0.6],
    ["G5", 0.6],
    ["G4", 0.6],
    ["C5", 0.6],
    ["C5", 0.45],
    ["C5", 0.15],
    ["C5", 0.6],
    ["E5", 0.3],
    ["C5", 0.3],
    ["G4", 0.6],
    ["C5", 1.2],
    ["C5", 0.45],
    ["E5", 0.15],
    ["G5", 0.6],
    ["G5", 0.3],
    ["E5", 0.3],
    ["G5", 0.3],
    ["E5", 0.6],
    ["E5", 0.3],
    ["C5", 0.3],
    ["E5", 0.3],
    ["C5", 0.6],
    ["C5", 0.3],
    ["E5", 0.3],
    ["C5", 0.3],
    ["G4", 1.2],
    ["C5", 0.6],
    ["E5", 0.6],
    ["G5", 0.6],
    ["E5", 0.6],
    ["C5", 0.6],
    ["E5", 0.6],
    ["G4", 0.6],
    ["C5", 0.6],
    ["C4", 0.6],
    ["G4", 0.6],
    ["C5", 1.2]
  ],
  "Charge (bugle call)": [
    ["C5", 0.375],
    ["C5", 0.125],
    ["C5", 0.375],
    ["C5", 0.125],
    ["C5", 0.375],
    ["C5", 0.125],
    ["C5", 0.375],
    ["C5", 0.125],
    ["C5", 0.375],
    ["C5", 0.125],
    ["C5", 0.375],
    ["C5", 0.125],
    ["G5", 0.375],
    ["E5", 0.125],
    ["G5", 0.375],
    ["E5", 0.125],
    ["G5", 0.375],
    ["E5", 0.125],
    ["C5", 0.375],
    ["C5", 0.125],
    ["C5", 0.375],
    ["C5", 0.125],
    ["C5", 0.375],
    ["C5", 0.125],
    ["G5", 0.375],
    ["E5", 0.125],
    ["G5", 0.375],
    ["E5", 0.125],
    ["G5", 0.375],
    ["E5", 0.125],
    ["C5", 1.5]
  ],
  "Charge (fanfare)": [
    ["G4", 0.5],
    ["C5", 0.5],
    ["E5", 0.5],
    ["G5", 0.75],
    ["E5", 0.25],
    ["G5", 2]
  ],
  "Church Call": [
    ["G4", 1.5],
    ["C5", 0.5],
    ["E5", 2.0],
    ["C5", 1.0],
    ["E5", 1.0],
    ["G4", 2.0],
    ["C5", 1.5],
    ["E5", 0.5],
    ["G5", 2.0],
    ["E5", 1.0],
    ["C5", 1.0],
    ["G4", 1.5],
    ["G4", 0.5],
    ["C5", 0.5],
    ["C5", 0.25],
    ["E5", 0.25],
    ["C5", 0.5],
    ["E5", 0.5],
    ["G4", 0.5],
    ["G4", 0.5],
    ["G4", 1.0],
    ["C5", 0.5],
    ["C5", 0.25],
    ["E5", 0.25],
    ["C5", 0.5],
    ["E5", 0.5],
    ["G5", 0.5],
    ["G5", 0.5],
    ["G4", 1.0],
    ["C5", 0.5],
    ["C5", 0.25],
    ["E5", 0.25],
    ["C5", 0.5],
    ["E5", 0.5],
    ["G4", 0.5],
    ["G4", 0.5],
    ["G4", 1.0],
    ["C5", 0.5],
    ["C5", 0.25],
    ["E5", 0.25],
    ["G5", 0.5],
    ["E5", 0.5],
    ["C5", 2.0]
  ],
  "Drill Call": [
    ["C5", 0.10416666666666667],
    ["C5", 0.10416666666666667],
    ["C5", 0.20833333333333334],
    ["G4", 0.10416666666666667],
    ["G4", 0.10416666666666667],
    ["G4", 0.20833333333333334],
    ["E5", 0.10416666666666667],
    ["E5", 0.10416666666666667],
    ["E5", 0.20833333333333334],
    ["C5", 0.10416666666666667],
    ["C5", 0.10416666666666667],
    ["C5", 0.20833333333333334, 0.20833333333333334],
    ["G4", 0.20833333333333334],
    ["C5", 0.10416666666666667],
    ["E5", 0.10416666666666667],
    ["G5", 0.20833333333333334],
    ["E5", 0.20833333333333334],
    ["G5", 0.625],
    ["C5", 0.10416666666666667],
    ["C5", 0.10416666666666667],
    ["C5", 0.20833333333333334],
    ["G4", 0.10416666666666667],
    ["G4", 0.10416666666666667],
    ["G4", 0.20833333333333334],
    ["E5", 0.10416666666666667],
    ["E5", 0.10416666666666667],
    ["E5", 0.20833333333333334],
    ["C5", 0.10416666666666667],
    ["C5", 0.10416666666666667],
    ["C5", 0.20833333333333334, 0.20833333333333334],
    ["G4", 0.20833333333333334],
    ["G4", 0.10416666666666667],
    ["G4", 0.10416666666666667],
    ["G4", 0.20833333333333334],
    ["G4", 0.20833333333333334],
    ["G4", 0.20833333333333334],
    ["C5", 0.4166666666666667],
    ["C5", 0.20833333333333334]
  ],
  "Fatigue Call": [
    ["C5", 0.3],
    ["E5", 0.3],
    ["C5", 0.3],
    ["G5", 0.3],
    ["G5", 0.15],
    ["G5", 0.15],
    ["G5", 0.15],
    ["G5", 0.3],
    ["C5", 0.3],
    ["E5", 0.3],
    ["C5", 0.3],
    ["G5", 0.3],
    ["G5", 0.15],
    ["G5", 0.15],
    ["G5", 0.15],
    ["G5", 0.3],
    ["C5", 0.3],
    ["E5", 0.3],
    ["C5", 0.3],
    ["G4", 0.6, 0.3],
    ["C5", 0.3],
    ["E5", 0.3],
    ["C5", 0.3],
    ["G5", 0.3],
    ["G5", 0.15],
    ["G5", 0.15],
    ["G5", 0.15],
    ["G5", 0.3],
    ["C5", 0.3],
    ["E5", 0.3],
    ["C5", 0.3],
    ["G5", 0.6, 0.3],
    ["C5", 0.3],
    ["C5", 0.15],
    ["C5", 0.15],
    ["C5", 0.15],
    ["C5", 0.3],
    ["C5", 0.9]
  ],
  "Fire Call": [
    ["G4", 0.2556818181818182],
    ["G4", 0.08522727272727272],
    ["E5", 0.6818181818, 0.3409090909090909],
    ["G4", 0.2556818181818182],
    ["G4", 0.08522727272727272],
    ["E5", 0.6818181818, 0.2556818181818182],
    ["G4", 0.08522727272727272],
    ["C5", 0.2556818181818182],
    ["E5", 0.08522727272727272],
    ["G5", 0.6818181818],
    ["E5", 0.2556818181818182],
    ["E5", 0.08522727272727272],
    ["C5", 0.2556818181818182],
    ["C5", 0.08522727272727272],
    ["G4", 0.6818181818, 0.59659090908],
    ["E5", 0.08522727272727272],
    ["C5", 0.2556818181818182],
    ["E5", 0.08522727272727272],
    ["G4", 0.2556818181818182],
    ["E5", 0.08522727272727272],
    ["C5", 0.2556818181818182],
    ["E5", 0.08522727272727272],
    ["G4", 0.2556818181818182],
    ["E5", 0.08522727272727272],
    ["C5", 0.2556818181818182],
    ["E5", 0.08522727272727272],
    ["G5", 0.2556818181818182],
    ["E5", 0.08522727272727272],
    ["C5", 0.3409090909090909],
    ["G4", 0.3409090909090909],
    ["C5", 0.2556818181818182],
    ["E5", 0.08522727272727272],
    ["G4", 0.2556818181818182],
    ["E5", 0.08522727272727272],
    ["C5", 0.2556818181818182],
    ["E5", 0.08522727272727272],
    ["G4", 0.2556818181818182],
    ["E5", 0.08522727272727272],
    ["C5", 0.2556818181818182],
    ["G4", 0.08522727272727272],
    ["E5", 0.2556818181818182],
    ["G4", 0.08522727272727272],
    ["C5", 0.6818181818]
  ],
  "First Call": [
    ["G4", 0.15625],
    ["C5", 0.15625],
    ["E5", 0.15625],
    ["G5", 0.3125],
    ["G5", 0.15625],
    ["G5", 0.15625],
    ["G5", 0.15625],
    ["G5", 0.3125],
    ["E5", 0.3125],
    ["E5", 0.15625],
    ["E5", 0.15625],
    ["E5", 0.15625],
    ["E5", 0.3125],
    ["C5", 0.3125],
    ["E5", 0.3125],
    ["C5", 0.3125],
    ["G4", 0.3125, 0.3125],
    ["G4", 0.15625],
    ["C5", 0.15625],
    ["E5", 0.15625],
    ["G5", 0.3125],
    ["G5", 0.15625],
    ["G5", 0.15625],
    ["G5", 0.15625],
    ["G5", 0.3125],
    ["G5", 0.3125],
    ["E5", 0.3125],
    ["C5", 0.3125],
    ["G4", 0.3125],
    ["G4", 0.15625],
    ["G4", 0.15625],
    ["G4", 0.15625],
    ["G4", 0.3125],
    ["C5", 0.625]
  ],
  "First Sergeant's Call": [
    ["G4", 0.125],
    ["C5", 0.125],
    ["E5", 0.125],
    ["G5", 0.25],
    ["G5", 0.125],
    ["G5", 0.125],
    ["G5", 0.125],
    ["G5", 0.25],
    ["G4", 0.125],
    ["C5", 0.125],
    ["E5", 0.125],
    ["G5", 0.25],
    ["G5", 0.125],
    ["G5", 0.125],
    ["G5", 0.125],
    ["G5", 0.25],
    ["G4", 0.125],
    ["C5", 0.125],
    ["E5", 0.125],
    ["G5", 0.25],
    ["G5", 0.125],
    ["G5", 0.125],
    ["G5", 0.125],
    ["G5", 0.25]
  ],
  "Reveille": [
    ["G4", 0.25],
    ["C5", 0.25],
    ["E5", 0.125],
    ["C5", 0.125],
    ["G4", 0.25],
    ["E5", 0.25],
    ["C5", 0.25],
    ["E5", 0.125],
    ["C5", 0.125],
    ["G4", 0.25],
    ["E5", 0.25],
    ["C5", 0.25],
    ["E5", 0.125],
    ["C5", 0.125],
    ["G4", 0.25],
    ["C5", 0.25],
    ["E5", 0.5],
    ["C5", 0.25],
    ["G4", 0.25],
    ["C5", 0.25],
    ["E5", 0.125],
    ["C5", 0.125],
    ["G4", 0.25],
    ["E5", 0.25],
    ["C5", 0.25],
    ["E5", 0.125],
    ["C5", 0.125],
    ["G4", 0.25],
    ["E5", 0.25],
    ["C5", 0.25],
    ["E5", 0.125],
    ["C5", 0.125],
    ["G4", 0.25],
    ["G4", 0.25],
    ["C5", 0.75],
    ["E5", 0.25],
    ["E5", 0.25],
    ["E5", 0.25],
    ["E5", 0.25],
    ["E5", 0.25],
    ["G5", 0.5],
    ["E5", 0.25],
    ["C5", 0.25],
    ["E5", 0.25],
    ["C5", 0.25],
    ["E5", 0.25],
    ["C5", 0.25],
    ["E5", 0.5],
    ["C5", 0.25],
    ["E5", 0.25],
    ["E5", 0.25],
    ["E5", 0.25],
    ["E5", 0.25],
    ["E5", 0.25],
    ["G5", 0.5],
    ["E5", 0.25],
    ["C5", 0.25],
    ["E5", 0.25],
    ["C5", 0.25],
    ["G4", 0.25],
    ["G4", 0.25],
    ["C5", 0.75]
  ],
  "Taps": [
    ["G4", 1.125],
    ["G4", 0.375],
    ["C5", 4.5],
    ["G4", 1.125],
    ["C5", 0.375],
    ["E5", 4.5],
    ["G4", 0.75],
    ["C5", 0.75],
    ["E5", 1.5],
    ["G4", 0.75],
    ["C5", 0.75],
    ["E5", 1.5],
    ["G4", 0.75],
    ["C5", 0.75],
    ["E5", 4.5],
    ["C5", 1.125],
    ["E5", 0.375],
    ["G5", 3.0],
    ["E5", 1.5],
    ["C5", 1.5],
    ["G4", 4.5],
    ["G4", 1.125],
    ["G4", 0.375],
    ["C5", 4.5]
  ]
}
  </script>
  <style type="text/css" media="screen">
body {
  background-color: white;
  color: black;
}
.hidden {
  display: none;
}
#original {
  margin-left: 1em;
}
ol {
  margin-left: 3em;
  padding: 0;
}
  </style>
</head>

<body>

<main>
<h1>Bugle call</h1>

<form id="playlist" name="playlist">

<div id="manifest"></div>

<input type="submit" id="play" value="Play">
</form>

<p>Plays the selected <a href="https://en.wikipedia.org/wiki/Bugle_call">bugle call</a> using tones.</p>

</main>

<script>
/*
 * Gap in seconds after each note before the next note.
 */
const GAP = -0.025;

const form = document.querySelector('#playlist');
const playButton = document.querySelector('#play');

let bugleCalls, current;

function reset() {
  bugleCalls = JSON.parse(document.querySelector('#calls').textContent);
  current = null;
  playButton.disabled = false;

  // Build the manifest of bugle calls based on the JSON object
  // It is bad form to generate HTML but it is only done once on load
  let markup = [];
  markup.push('<ol>');
  for (let name of Object.keys(bugleCalls)) {
    markup.push(`  <li><label><input type="radio" name="callName" value="${ name }">${ name }</label></li>`);
  }
  markup.push('</ol>');
  document.querySelector('#manifest').innerHTML = markup.join('\n');
}

/*
 * Play the current note and schedule the next note to play.
 */
function play() {
  let [note, duration, gap=GAP] = current.shift();
  if (current.length > 0) {
    if (gap <= 0) {
      clock.schedule(play, duration);
    }
    else {
      // If gap is positive, then there is a rest after this note
      clock.schedule(play, duration + gap);
    }
  }
  else {
    current = null;
    playButton.disabled = false;
  }

  if (gap <= 0) {
    tone.play(note, duration + gap);
  }
  else {
    // If gap is positive, then there is a rest after this note
    tone.play(note, duration);
  }
}

window.addEventListener('load', (event) => {
  reset();
});
form.addEventListener('submit', (event) => {
  if (current == null) {
    // If a bugle call is not currently playing
    playButton.disabled = true;
    current = bugleCalls[form.callName.value].slice();

    // Manually start the core game loop because there is no game screen
    screen.go();

    // Play the bugle call
    play();
  }

  event.preventDefault();
});
</script>
</body>

</html>
